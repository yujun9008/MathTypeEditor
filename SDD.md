# MathType 公式编辑器 - 软件开发文档 (SDD)

## 1. 项目概述

### 1.1 项目名称
MathType 公式编辑器 (MathType Editor)

### 1.2 项目描述
一个独立的数学公式编辑器组件，基于 React 和 Ant Design 开发，提供两种公式编辑模式：基于 MathLive 的可视化编辑和基于 LaTeX 的文本编辑。该组件支持实时预览、公式库、粘贴处理等功能。

### 1.3 项目目标
- 提供直观易用的数学公式编辑界面
- 支持多种公式编辑模式，满足不同用户需求
- 实现高质量的公式渲染效果
- 提供丰富的预设公式库
- 支持公式粘贴和格式化处理
- 便于集成到各种 React 应用中

## 2. 功能规格说明

### 2.1 核心功能
1. **双模式编辑**：
   - MathLive 模式：可视化公式编辑器
   - LaTeX 模式：纯文本 LaTeX 编辑

2. **公式预览**：
   - 实时 LaTeX 到数学公式的转换和渲染
   - 使用 KaTeX 进行高质量渲染

3. **公式库**：
   - 提供分类的预设公式（数学、希腊字母、关系符号等）
   - 快速插入常用公式

4. **粘贴处理**：
   - 智能处理粘贴的公式内容
   - 自动修复不匹配的括号和环境

### 2.2 用户界面
1. **编辑区域**：
   - 模式切换段选择器
   - MathLive 编辑器或 LaTeX 文本框
   - 公式预览区域

2. **公式库区域**：
   - 分类标签页（数学、希腊、关系等）
   - 可点击的预设公式

### 2.3 技术特性
1. **响应式设计**：适配不同屏幕尺寸
2. **可定制样式**：支持外部样式覆盖
3. **无障碍访问**：遵循 WAI-ARIA 标准
4. **性能优化**：高效的渲染和更新机制

## 3. 架构设计

### 3.1 技术栈
- **前端框架**：React 17+/18+
- **UI 组件库**：Ant Design 5.x
- **公式引擎**：MathLive（编辑） + KaTeX（渲染）
- **样式处理**：Less
- **类型检查**：TypeScript

### 3.2 组件结构
```
MathEditor (主组件)
├── 模式切换区 (Segmented)
├── 编辑内容区
│   ├── MathLive 模式
│   │   └── math-field 元素
│   └── LaTeX 模式
│       ├── 输入区域 (Input.TextArea)
│       └── 预览区域 (HTML 渲染)
└── 公式库区 (Tabs)
    └── 预设公式 (KATEXLIST)
```

### 3.3 数据流
1. 用户在任一编辑模式中输入公式
2. 组件状态同步更新 LaTeX 字符串
3. 实时渲染预览
4. 通过 onChange 回调通知父组件

## 4. 接口规范

### 4.1 组件 Props
```typescript
interface MathEditorProps {
  /** 默认值 */
  defaultValue?: string;
  /** 值变化回调 */
  onChange?: (value: string) => void;
  /** 自定义样式 */
  style?: React.CSSProperties;
}
```

### 4.2 事件处理
- `onChange`: 当公式内容发生变化时触发
- `onModeChange`: 当编辑模式切换时触发（内部）

## 5. 依赖管理

### 5.1 运行时依赖
- `react`: ^17.0.0 || ^18.0.0
- `antd`: ^5.0.0
- `katex`: ^0.16.0
- `mathlive`: ^0.90.1

### 5.2 开发依赖
- `typescript`: ^4.9.0
- `vite`: ^4.0.0
- `@vitejs/plugin-react`: ^3.0.0
- `less`: ^4.1.0
- 类型定义包

## 6. 构建与部署

### 6.1 构建流程
1. 编译 TypeScript 代码
2. 处理 Less 样式
3. 生成 ESM 和 CJS 两种模块格式
4. 生成类型声明文件

### 6.2 发布流程
1. 运行测试和类型检查
2. 执行构建命令
3. 验证输出文件
4. 发布到 npm

## 7. 测试策略

### 7.1 单元测试
- 组件渲染测试
- 交互逻辑测试
- 边界条件测试

### 7.2 集成测试
- 不同编辑模式切换
- 公式渲染准确性
- 粘贴处理功能

## 8. 性能考虑

### 8.1 渲染优化
- 避免不必要的重渲染
- 合理使用 React.memo
- KaTeX 渲染缓存

### 8.2 内存管理
- 正确清理事件监听器
- 避免内存泄漏
- 适当的垃圾回收

## 9. 安全性

### 9.1 XSS 防护
- 对用户输入进行适当转义
- 使用安全的 HTML 插入方法
- 验证和过滤公式内容

## 10. 维护与扩展

### 10.1 代码维护
- 遵循 TypeScript 最佳实践
- 保持代码结构清晰
- 提供充分的注释

### 10.2 功能扩展
- 支持更多公式格式
- 增加导出功能
- 提供主题定制选项

## 11. 版本控制策略

### 11.1 分支策略
- `main`: 生产就绪代码
- `develop`: 开发版本
- `feature/*`: 功能分支
- `release/*`: 发布候选
- `hotfix/*`: 紧急修复

### 11.2 发布版本
- 遵循语义化版本控制 (SemVer)
- 主版本号：重大变更
- 次版本号：向后兼容的功能添加
- 修订号：向后兼容的问题修正

## 12. 部署与发布

### 12.1 npm 发布
- 包名：@math-type/editor
- 许可证：MIT
- 文件包含：编译后的代码、类型定义、文档

### 12.2 CDN 支持
- 提供 UMD 版本
- 支持直接浏览器引入